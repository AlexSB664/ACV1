{% extends 'base.html' %}
{% load static %}
  {% block title %} Inicio {% endblock %}
  {% block menubar %}{% include "usuario/menu.html" %}{% endblock %}

{% block content %}
            <div class="row">
                <div class="col-lg-12">
                    <div class="ibox float-e-margins">
                        <div class="ibox-title">
                            <h5>Facturas del mes {%  now "F" %} de {% now 'Y' %} <small> Ayuda Contable</small></h5>
                            <div class="ibox-tools">
                                <a class="collapse-link">
                                    <i class="fa fa-chevron-up"></i>
                                </a>
                                <a class="close-link">
                                    <i class="fa fa-times"></i>
                                </a>
                            </div>
                        </div>
                        <div class="ibox-content">
                        <input type="month" id="start" name="start" min="2018-01" value="{% now 'Y' %}-{%  now 'm' %}" onchange="myFunction(this.value)">
                        <script>
                        function myFunction(val) {
                        alert("The input value has changed. The new value is: " + val);
                        }
                        function cambiarFecha(val){
                            var valor = document.getElementById('inputBusqueda').value;
                            var x = new XMLHttpRequest();
                            x.open('GET','/tutores/busqueda/?filtro=' + valor)
                            x.onreadystatechange = function (e) {
                                if (x.readyState == 4) {
                                    if (x.status === 200) {
                                        x.addEventListener('load', function(e){
                                            var jsonData = JSON.parse(x.responseText.replace(/\'/g,'"'))
                                            iterarObjeto(jsonData);
                                        });
                                    } else {
                                        console.error(x.status);
                                    }
                                }
                            }
                            x.send();
                        }
                        </script>
                        {% if total == 0 %}
                        <h1>No hay facturas en este mes</h1>
                        {% else %}
                        <div class="table-responsive">
                        <table class="table">
                        <thead>
                        <tr>
                            <th>Acciones</th>
                            <th>RFC Cliente</th> 
                            <th>Raz√≥n Social</th>
                            <th>Fecha de Emision</th>
                            <th>Vigente</th>
                            <th>SubTotal</th>
                            <th>Total</th>
                        </tr>
                        </thead>
                        {% for renglon in tabla %}
                        <tr>
                            {% for columna in renglon %}
                            {% if forloop.first %}
                            <th><a href="{{columna.0.url}}" download>Descargar XML</a>
                            <a href="{{columna.1.url}}" download>Descargar PDF</a></th>
                            {% else %}
                                <th>{{columna}}</th>
                            {% endif %}
                            {% endfor %}
                        </tr>
                        {% endfor %}
                        <tr>
                            <th></th>
                            <th></th>
                            <th></th>
                            <th></th>
                            <th></th>
                            <th>Total del Mes:</th>
                            <th>{{total}}</th>
                        </tr>
                        </table>
                        </div>
                        {% endif %}


                        </div>
                    </div>
                </div>
            </div>

{% endblock %}